<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Barber√≠a Premium | Agenda</title>

<style>
body{
    background:#111;
    color:#fff;
    font-family:Segoe UI,sans-serif;
}
.container{
    max-width:450px;
    margin:auto;
    padding:20px;
}
.card{
    background:#1e1e1e;
    border-radius:12px;
    padding:20px;
    margin-top:20px;
}
.logo img{
    max-width:150px;
    display:block;
    margin:auto;
}
select,input,button{
    width:100%;
    padding:10px;
    margin:8px 0;
    border-radius:6px;
    border:none;
}
button{
    background:#c59d5f;
    font-weight:bold;
    cursor:pointer;
}
.hora{
    background:#2a2a2a;
    padding:10px;
    margin:6px 0;
    border-radius:6px;
    text-align:center;
    cursor:pointer;
}
.hora.ocupada{
    background:#555;
    text-decoration:line-through;
    cursor:not-allowed;
}
.barbero-img{
    width:100%;
    border-radius:10px;
    margin-top:10px;
}
.admin{
    display:none;
}
.cita,.barbero-admin{
    border-bottom:1px solid #444;
    padding:6px 0;
}
</style>
</head>

<body>
<div class="container">

<!-- LOGO -->
<div class="logo">
    <img id="logoImg">
</div>

<!-- CLIENTE -->
<div class="card">
<h3>Agendar cita</h3>

<label>Nombre</label>
<input id="nombre">

<label>Barbero</label>
<select id="barberoSelect"></select>

<img id="barberoImg" class="barbero-img">

<label>Fecha</label>
<input type="date" id="fecha">

<div id="horarios"></div>

<button onclick="reservar()">Reservar y enviar WhatsApp</button>
</div>

<button onclick="modoAdmin()">Modo administrador</button>

<!-- ADMIN -->
<div class="card admin" id="admin">
<h3>Administrador</h3>

<label>Subir logo</label>
<input type="file" accept="image/*" onchange="subirLogo(this)">

<h4>Agregar barbero</h4>
<input id="nuevoBarbero" placeholder="Nombre del barbero">
<input id="nuevoTelefono" placeholder="WhatsApp (521...)">
<input type="file" accept="image/*" onchange="subirFotoBarbero(this)">
<button onclick="agregarBarbero()">Agregar barbero</button>

<h4>Barberos registrados</h4>
<div id="listaBarberos"></div>

<h4>Configuraci√≥n de horario</h4>
<label>Inicio</label>
<input type="time" id="inicio">

<label>Fin</label>
<input type="time" id="fin">

<label>Intervalo</label>
<select id="intervalo">
    <option value="60">60 minutos</option>
    <option value="30">30 minutos</option>
    <option value="15">15 minutos</option>
</select>

<button onclick="guardarHorario()">Guardar horario</button>

<h4>Citas</h4>
<div id="listaCitas"></div>

<button onclick="cerrarSesion()">Cerrar sesi√≥n</button>
</div>

</div>

<script>
// ================= CONFIGURACI√ìN =================
const PASSWORD_ADMIN = "barberia123";
const FOTO_DEFAULT = "https://via.placeholder.com/400x250?text=Barbero";

// ================= DATOS =================
let horario = JSON.parse(localStorage.getItem("horario")) || {
    inicio:"10:00", fin:"20:00", intervalo:30
};

let barberos = JSON.parse(localStorage.getItem("barberos")) || [];
let citas = JSON.parse(localStorage.getItem("citas")) || [];

let fotoTemp = null;
let horaSeleccionada = null;

// ================= INICIALIZACI√ìN =================
const adminDiv = document.getElementById("admin");
const logoImg = document.getElementById("logoImg");
const barberoSelect = document.getElementById("barberoSelect");
const barberoImg = document.getElementById("barberoImg");
const fechaInput = document.getElementById("fecha");
const horariosDiv = document.getElementById("horarios");
const listaBarberos = document.getElementById("listaBarberos");
const listaCitas = document.getElementById("listaCitas");

logoImg.src = localStorage.getItem("logo") || "";

document.getElementById("inicio").value = horario.inicio;
document.getElementById("fin").value = horario.fin;
document.getElementById("intervalo").value = horario.intervalo;

fechaInput.addEventListener("change", cargarHorarios);
barberoSelect.addEventListener("change", mostrarFotoBarbero);

cargarBarberos();

// ================= CLIENTE =================
function cargarBarberos(){
    barberoSelect.innerHTML = "";
    barberos.forEach((b,i)=>{
        barberoSelect.innerHTML += `<option value="${i}">${b.nombre}</option>`;
    });
    mostrarFotoBarbero();
    mostrarBarberosAdmin();
}

function mostrarFotoBarbero(){
    const b = barberos[barberoSelect.value];
    barberoImg.src = (b && b.foto) ? b.foto : FOTO_DEFAULT;
}

function generarHoras(inicio, fin, intervalo){
    let horas = [];
    let [hi, mi] = inicio.split(":").map(Number);
    let [hf, mf] = fin.split(":").map(Number);

    for(let t = hi*60+mi; t < hf*60+mf; t += intervalo){
        let h = Math.floor(t/60).toString().padStart(2,"0");
        let m = (t%60).toString().padStart(2,"0");
        horas.push(`${h}:${m}`);
    }
    return horas;
}

function cargarHorarios(){
    horariosDiv.innerHTML = "";
    horaSeleccionada = null;
    if(!fechaInput.value || barberos.length === 0) return;

    let barbero = barberos[barberoSelect.value].nombre;
    let horas = generarHoras(horario.inicio, horario.fin, horario.intervalo);

    horas.forEach(h=>{
        let div = document.createElement("div");
        div.className = "hora";
        div.textContent = h;

        if(citas.find(c=>c.fecha===fechaInput.value && c.hora===h && c.barbero===barbero)){
            div.classList.add("ocupada");
        } else {
            div.onclick = () => {
                horaSeleccionada = h;
                alert("Hora seleccionada: " + h);
            };
        }
        horariosDiv.appendChild(div);
    });
}

function reservar(){
    if(!nombre.value || !fechaInput.value || !horaSeleccionada){
        alert("Completa todos los campos");
        return;
    }

    let barbero = barberos[barberoSelect.value];

    citas.push({
        nombre: nombre.value,
        fecha: fechaInput.value,
        hora: horaSeleccionada,
        barbero: barbero.nombre
    });

    localStorage.setItem("citas", JSON.stringify(citas));

    let mensaje = `Hola, quiero agendar una cita üíà
Nombre: ${nombre.value}
Barbero: ${barbero.nombre}
Fecha: ${fechaInput.value}
Hora: ${horaSeleccionada}`;

    window.open(
        `https://wa.me/${barbero.telefono}?text=${encodeURIComponent(mensaje)}`,
        "_blank"
    );

    cargarHorarios();
}

// ================= ADMIN =================
function modoAdmin(){
    const pass = prompt("Contrase√±a administrador");
    if(pass === PASSWORD_ADMIN){
        adminDiv.style.display = "block";
        mostrarCitas();
        mostrarBarberosAdmin();
    } else {
        alert("Contrase√±a incorrecta");
    }
}

function cerrarSesion(){
    adminDiv.style.display = "none";
}

function guardarHorario(){
    horario = {
        inicio: document.getElementById("inicio").value,
        fin: document.getElementById("fin").value,
        intervalo: parseInt(document.getElementById("intervalo").value)
    };
    localStorage.setItem("horario", JSON.stringify(horario));
    cargarHorarios();
}

// ================= BARBEROS =================
function subirFotoBarbero(input){
    if(!input.files[0]){
        fotoTemp = null;
        return;
    }
    let r = new FileReader();
    r.onload = () => fotoTemp = r.result;
    r.readAsDataURL(input.files[0]);
}

function agregarBarbero(){
    if(!nuevoBarbero.value || !nuevoTelefono.value){
        alert("Nombre y WhatsApp obligatorios");
        return;
    }

    barberos.push({
        nombre: nuevoBarbero.value,
        telefono: nuevoTelefono.value,
        foto: fotoTemp || ""
    });

    localStorage.setItem("barberos", JSON.stringify(barberos));
    nuevoBarbero.value = "";
    nuevoTelefono.value = "";
    fotoTemp = null;

    cargarBarberos();
}

function mostrarBarberosAdmin(){
    listaBarberos.innerHTML = "";
    barberos.forEach((b,i)=>{
        listaBarberos.innerHTML += `
        <div class="barbero-admin">
            <strong>${b.nombre}</strong><br>
            üì± ${b.telefono}
            <button onclick="eliminarBarbero(${i})">Eliminar</button>
        </div>`;
    });
}

function eliminarBarbero(i){
    if(!confirm("¬øEliminar barbero y sus citas?")) return;
    let nombre = barberos[i].nombre;
    barberos.splice(i,1);
    citas = citas.filter(c=>c.barbero !== nombre);

    localStorage.setItem("barberos", JSON.stringify(barberos));
    localStorage.setItem("citas", JSON.stringify(citas));

    cargarBarberos();
    mostrarCitas();
}

// ================= CITAS =================
function mostrarCitas(){
    listaCitas.innerHTML = "";
    citas.forEach((c,i)=>{
        listaCitas.innerHTML += `
        <div class="cita">
            ${c.nombre} | ${c.barbero}<br>
            ${c.fecha} ${c.hora}
            <button onclick="eliminarCita(${i})">X</button>
        </div>`;
    });
}

function eliminarCita(i){
    citas.splice(i,1);
    localStorage.setItem("citas", JSON.stringify(citas));
    mostrarCitas();
    cargarHorarios();
}

// ================= LOGO =================
function subirLogo(input){
    let r = new FileReader();
    r.onload = () => {
        localStorage.setItem("logo", r.result);
        logoImg.src = r.result;
    };
    r.readAsDataURL(input.files[0]);
}
</script>

</body>
</html>
